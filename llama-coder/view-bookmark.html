<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>View Bookmark</title>
        <link rel="stylesheet" href="bookmark.css" />
        <style>
            /* Custom styles for invalid fields */
            input:invalid,
            textarea:invalid {
                border: 2px solid red;
                background-color: #f8d7da; /* Light red */
                color: #721c24; /* Dark red text for contrast */
            }

            input:valid,
            textarea:valid {
                border: 2px solid green;
                background-color: #d4edda; /* Light green */
                color: #155724; /* Dark green text for contrast */
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="form-container">
                <div class="left-column">
                    <h2>View Bookmark</h2>
                    <form id="bookmark-form">
                        <label for="title">Title *</label>
                        <input
                            type="text"
                            id="title"
                            value="Sample Bookmark Title"
                            readonly
                            required
                        />

                        <label for="url">URL *</label>
                        <input
                            type="url"
                            id="url"
                            value="https://example.com"
                            readonly
                            required
                        />

                        <label for="category">Category *</label>
                        <input
                            type="text"
                            id="category"
                            value="Personal"
                            readonly
                            required
                        />

                        <label for="tags">Tags</label>
                        <input
                            type="text"
                            id="tags"
                            value="tag1, tag2, tag3"
                            readonly
                        />

                        <div class="form-actions">
                            <button
                                type="button"
                                class="edit-btn"
                                id="edit-btn"
                            >
                                Edit
                            </button>
                            <button
                                type="button"
                                class="delete-btn hidden"
                                id="delete-btn"
                                onclick="delete_bookmark()"
                            >
                                Delete
                            </button>
                            <button
                                type="submit"
                                class="save-btn hidden"
                                id="save-btn"
                            >
                                Save
                            </button>
                        </div>
                    </form>
                </div>
                <div class="right-column">
                    <label for="notes">Notes</label>
                    <textarea id="notes" readonly>
Sample notes about this bookmark.</textarea
                    >
                </div>
            </div>
        </div>

        <script src="save-to-file.js"></script>
        <script>
            const editBtn = document.getElementById("edit-btn");
            const saveBtn = document.getElementById("save-btn");
            const deleteBtn = document.getElementById("delete-btn");
            const inputs = document.querySelectorAll("input, textarea");
            const heading = document.querySelector("h2");
            const form = document.getElementById("bookmark-form");

            // Extract the bookmark ID from the URL query string
            const urlParams = new URLSearchParams(window.location.search);
            const bookmarkId = parseInt(urlParams.get("id")); // Get the ID from the query string

            // Fetch all bookmarks from localStorage
            const storedBookmarks =
                JSON.parse(localStorage.getItem("bookmarks")) || [];
            const bookmark = storedBookmarks.find((b) => b.id === bookmarkId); // Find the bookmark by ID

            if (bookmark) {
                // Populate the form fields with the bookmark data
                document.getElementById("title").value = bookmark.title;
                document.getElementById("url").value = bookmark.url;
                document.getElementById("category").value = bookmark.category;
                document.getElementById("tags").value =
                    bookmark.tags.join(", ");
                document.getElementById("notes").value = bookmark.notes;
            } else {
                alert("Bookmark not found!");
            }

            editBtn.addEventListener("click", () => {
                inputs.forEach((input) => input.removeAttribute("readonly"));
                editBtn.classList.add("hidden");
                saveBtn.classList.remove("hidden");
                deleteBtn.classList.remove("hidden");

                // Change the heading when editing
                heading.textContent = "Edit Bookmark";
            });

            saveBtn.addEventListener("click", (e) => {
                e.preventDefault(); // Prevent form submission (you can keep the button as submit for easy styling)

                // Validate form fields
                if (form.checkValidity()) {
                    heading.textContent = "View Bookmark";
                    inputs.forEach((input) =>
                        input.setAttribute("readonly", true)
                    );
                    saveBtn.classList.add("hidden");
                    deleteBtn.classList.add("hidden");
                    editBtn.classList.remove("hidden");

                    // Save the updated bookmark data
                    const updatedBookmark = {
                        ...bookmark,
                        title: document.getElementById("title").value,
                        url: document.getElementById("url").value,
                        category: document.getElementById("category").value,
                        tags: document
                            .getElementById("tags")
                            .value.split(",")
                            .map((tag) => tag.trim()),
                        notes: document.getElementById("notes").value,
                    };

                    // Update the bookmark in localStorage
                    const updatedBookmarks = storedBookmarks.map((b) =>
                        b.id === bookmarkId ? updatedBookmark : b
                    );

                    localStorage.setItem(
                        "bookmarks",
                        JSON.stringify(updatedBookmarks)
                    );

                    saveBookmarksToTimestampedFile();
                } else {
                    alert("Please fill in all required fields correctly.");
                }
            });

            function delete_bookmark() {
                // Ask for confirmation before deleting the bookmark
                const confirmation = confirm(
                    "Are you sure you want to delete this bookmark?"
                );
                if (confirmation) {
                    // Remove bookmark from localStorage
                    const updatedBookmarks = storedBookmarks.filter(
                        (b) => b.id !== bookmarkId
                    );
                    localStorage.setItem(
                        "bookmarks",
                        JSON.stringify(updatedBookmarks)
                    );
                    saveBookmarksToTimestampedFile;
                    window.close();
                }
            }
        </script>
    </body>
</html>
